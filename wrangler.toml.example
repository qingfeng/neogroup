name = "neogroup"
main = "src/index.ts"
compatibility_date = "2024-01-01"
workers_dev = true

[vars]
APP_NAME = "NeoGroup"
APP_URL = "https://your-domain.com"
# MASTODON_BOT_TOKEN/DOMAIN are deprecated

[[d1_databases]]
binding = "DB"
database_name = "neogroup"
database_id = "your-database-id-here"  # 运行 wrangler d1 create neogroup 获取

[[kv_namespaces]]
binding = "KV"
id = "your-kv-namespace-id-here"  # 运行 wrangler kv namespace create KV 获取

# R2 存储（可选，用于图片上传）
# [[r2_buckets]]
# binding = "R2"
# bucket_name = "neogroup-uploads"

# Workers AI（可选，用于 Bot 长文自动生成标题）
# [ai]
# binding = "AI"

# Nostr 集成（可选，将帖子同步到 Nostr 网络）
# 配置 NOSTR_MASTER_KEY + NOSTR_QUEUE 后自动启用所有 Nostr/DVM 功能
# 不配置则全部 Nostr 功能关闭（由 isNostrEnabled() 控制）
# 需要先设置 secrets：
#   npx wrangler secret put NOSTR_MASTER_KEY   # AES-256 密钥，openssl rand -hex 32 生成
#   npx wrangler secret put NOSTR_RELAYS       # 逗号分隔的 relay 地址，如 wss://relay.damus.io,wss://nos.lol
# 然后创建 Queue：
#   npx wrangler queues create nostr-events
#   npx wrangler queues create nostr-events-dlq
# 最后取消以下注释：

# [vars] 中添加（NIP-05 推荐 relay）：
# NOSTR_RELAY_URL = "wss://relay.damus.io"

# [[queues.producers]]
# queue = "nostr-events"
# binding = "NOSTR_QUEUE"

# [[queues.consumers]]
# queue = "nostr-events"
# max_batch_size = 20
# max_retries = 5
# dead_letter_queue = "nostr-events-dlq"

# NIP-72: Nostr 社区轮询（可选，每 5 分钟从 relay 拉取社区帖子）
# 需要先完成 Nostr 基础集成（NOSTR_MASTER_KEY、NOSTR_RELAYS、Queue）
# [triggers]
# crons = ["*/5 * * * *"]

# 自建 Nostr Relay（可选，需先部署 relay/ 子项目）
# 外部 Agent 可连接 wss://your-relay.com 订阅 DVM 任务
# Worker 通过 Service Binding 内部写入，绕过同账号 WebSocket 限制
# [[services]]
# binding = "RELAY_SERVICE"
# service = "neogroup-relay"

# [vars] 中添加（可选，最低 PoW 难度，默认 20）：
# NOSTR_MIN_POW = "20"

# 自定义域名（可选）
# [[routes]]
# pattern = "your-domain.com"
# custom_domain = true

[site]
bucket = "./public"
